<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tour Expense Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4f46e5;
      --secondary: #facc15;
      --positive: #10b981;
      --negative: #ef4444;
      --light-bg: #f5f7fa;
      --dark-bg: #1f1f2e;
      --text-light: #fff;
      --text-dark: #333;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(to right, #f5f7fa, #c3cfe2);
      margin: 0;
      padding: 20px;
      transition: 0.3s;
    }

    body.dark {
      background: linear-gradient(to right, #1f1f2e, #2a2a3d);
      color: var(--text-light);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: var(--primary);
    }

    .container {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
      background: linear-gradient(to bottom right, #ffffff, #f0f4ff);
      transition: 0.3s;
    }

    body.dark .container {
      background: linear-gradient(to bottom right, #2c2c3e, #3a3a4d);
    }

    .form-group,
    .expense-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }

    input,
    select {
      flex: 1;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #ccc;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.05);
      transition: all 0.3s;
    }

    input:focus,
    select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 8px rgba(79, 70, 229, 0.3);
      outline: none;
    }

    button {
      padding: 12px 20px;
      background: linear-gradient(to right, var(--primary), #6366f1);
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      transition: 0.3s;
    }

    th,
    td {
      padding: 12px;
      text-align: center;
      border: 1px solid #ddd;
      transition: 0.3s;
    }

    th {
      background-color: #e0e7ff;
    }

    body.dark th {
      background-color: #3b3b5e;
    }

    tbody tr:nth-child(even) {
      background-color: #f3f4f6;
    }

    body.dark tbody tr:nth-child(even) {
      background-color: #2a2a3e;
    }

    tbody tr:hover {
      background-color: #e0e7ff;
    }

    body.dark tbody tr:hover {
      background-color: #4b4b66;
    }

    .green {
      color: var(--positive);
      font-weight: 600;
    }

    .red {
      color: var(--negative);
      font-weight: 600;
    }

    .box-style {
      margin-top: 20px;
      padding: 20px;
      border-radius: 16px;
      border: 1px solid var(--primary);
      background: linear-gradient(to right, #dbeafe, #e0f2fe);
      transition: 0.3s;
    }

    body.dark .box-style {
      background: linear-gradient(to right, #3b3b5e, #4a4a6f);
      border-color: #6366f1;
    }

    .box-style h3 {
      margin-bottom: 10px;
      color: var(--primary);
    }

    .box-style ul {
      margin-left: 20px;
    }

    .developer-info {
      text-align: center;
      margin-top: 50px;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      background: linear-gradient(to right, #eef2ff, #e0f2fe);
      transition: 0.3s;
    }

    body.dark .developer-info {
      background: linear-gradient(to right, #3a3a5e, #4a4a6f);
    }

    .developer-info img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 15px;
      border: 3px solid var(--primary);
      transition: 0.3s;
    }

    .developer-info img:hover {
      transform: scale(1.05);
    }

    footer {
      text-align: center;
      margin-top: 30px;
      padding: 15px 10px;
      font-size: 0.9rem;
      color: #666;
      border-top: 1px solid #ccc;
      background-color: #f9f9f9;
      transition: 0.3s;
    }

    body.dark footer {
      background-color: #2c2c3e;
      color: #aaa;
      border-top-color: #444;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .top-bar button {
      background: var(--secondary);
      color: var(--text-dark);
    }

    body.dark .top-bar button {
      background: #facc15;
      color: #1f1f2e;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="top-bar">
      <button onclick="downloadPDF()">Download PDF ðŸ“„</button>
      <button onclick="toggleDarkMode()">ðŸŒ™ Dark Mode</button>
    </div>
    <h1>Tour Expense Tracker</h1>

    <div class="form-group">
      <input type="text" id="memberName" placeholder="Enter Member Name">
      <button onclick="addMember()">Add Member</button>
    </div>

    <div class="expense-group">
      <input type="number" id="amount" placeholder="Amount (BDT)">
      <select id="sharedWith" multiple style="min-width: 200px;"></select>
      <input type="text" id="expenseType" placeholder="Expense Type">
      <input type="date" id="expenseDate">
      <button onclick="addExpense()">Add Expense</button>
    </div>

    <table id="balanceTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Paid (BDT)</th>
          <th>Should Pay (BDT)</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="box-style" id="summaryBox" style="display: none;">
      <h3>Summary</h3>
      <p id="totalExpense"></p>
      <p id="fairShare"></p>

      <div class="box-style">
        <h3>Balances ðŸ’°</h3>
        <ul id="balancesList"></ul>
      </div>

      <div class="box-style">
        <h3>Expense Statement ðŸ“Š</h3>
        <table id="statementTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Payer</th>
              <th>Expense Type</th>
              <th>Amount (BDT)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <p id="statementTotal"></p>
      </div>

      <div class="box-style">
        <h3>Settlement Suggestions âœ…</h3>
        <ul id="settlementList"></ul>
      </div>
    </div>
  </div>

  <div class="developer-info">
    <img src="/Foridul1.png" alt="MD Foridul Islam">
    <h3>MD Foridul Islam</h3>
    <p>Student, Computer Science & Engineering</p>
    <p>Daffodil International University</p>
  </div>

  <footer>
    Copyright &copy; 2025 Foridul. All Rights Reserved.
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script>
    let members = [];
    let expenses = [];

    function addMember() {
      const name = document.getElementById("memberName").value.trim();
      if (name && !members.includes(name)) {
        members.push(name);
        updateMemberOptions();
        updateTable();
        document.getElementById("memberName").value = "";
      }
    }

    function updateMemberOptions() {
      const sharedWith = document.getElementById("sharedWith");
      sharedWith.innerHTML = "";
      members.forEach((member) => {
        const option = document.createElement("option");
        option.value = member;
        option.textContent = member;
        sharedWith.appendChild(option);
      });
    }

    function addExpense() {
      const amount = parseFloat(document.getElementById("amount").value);
      const sharedOptions = Array.from(document.getElementById("sharedWith").selectedOptions);
      const sharedBy = sharedOptions.map(opt => opt.value);
      const date = document.getElementById("expenseDate").value;
      const type = document.getElementById("expenseType").value.trim();
      if (isNaN(amount) || sharedBy.length === 0 || type === "") return;

      const payer = sharedBy[0];
      expenses.push({ payer, amount, sharedBy, date, type });

      document.getElementById("amount").value = "";
      document.getElementById("sharedWith").selectedIndex = -1;
      document.getElementById("expenseDate").value = "";
      document.getElementById("expenseType").value = "";

      updateTable();
    }

    function updateTable() {
      const tableBody = document.querySelector("#balanceTable tbody");
      tableBody.innerHTML = "";

      let paidMap = {}, shareMap = {}, totalExpense = 0;
      members.forEach(m => { paidMap[m] = 0; shareMap[m] = 0; });
      expenses.forEach(e => { paidMap[e.payer] += e.amount; totalExpense += e.amount; });

      const equalShare = totalExpense / members.length;
      members.forEach(member => { shareMap[member] = equalShare; });

      let balances = {};
      members.forEach(member => {
        let balance = paidMap[member] - shareMap[member];
        balances[member] = balance;
        tableBody.innerHTML += `
          <tr>
            <td>${member}</td>
            <td>${paidMap[member].toFixed(2)}</td>
            <td>${shareMap[member].toFixed(2)}</td>
            <td class="${balance>=0?'green':'red'}">${balance>=0?'+':''}${balance.toFixed(2)}</td>
          </tr>
        `;
      });

      showSummary(balances, totalExpense);
    }

    function showSummary(balances, totalExpense) {
      document.getElementById("summaryBox").style.display = "block";
      document.getElementById("totalExpense").innerText = `Total Expense: BDT ${totalExpense.toFixed(2)}`;
      document.getElementById("fairShare").innerText = `Fair Share per Person: BDT ${(totalExpense / members.length).toFixed(2)}`;

      const balanceList = document.getElementById("balancesList");
      balanceList.innerHTML = "";
      for (let [name, balance] of Object.entries(balances)) {
        balanceList.innerHTML += `<li>${balance>=0?`${name}: Should receive BDT ${balance.toFixed(2)}`:`${name}: Owes BDT ${Math.abs(balance).toFixed(2)}`}</li>`;
      }

      const statementTableBody = document.querySelector("#statementTable tbody");
      statementTableBody.innerHTML = "";
      expenses.forEach(e => {
        statementTableBody.innerHTML += `
          <tr>
            <td>${e.date||"No Date"}</td>
            <td>${e.payer}</td>
            <td>${e.type}</td>
            <td>BDT ${e.amount.toFixed(2)}</td>
          </tr>
        `;
      });
      document.getElementById("statementTotal").innerText = `Total Cost: BDT ${totalExpense.toFixed(2)}`;

      const settlementList = document.getElementById("settlementList");
      settlementList.innerHTML = "";
      let payers = [], receivers = [];
      for (let [name, balance] of Object.entries(balances)) {
        if (balance<0) payers.push({name, amount:-balance});
        else if (balance>0) receivers.push({name, amount:balance});
      }
      payers.sort((a,b)=>b.amount-a.amount); receivers.sort((a,b)=>b.amount-a.amount);
      for(let payer of payers){
        for(let receiver of receivers){
          if(payer.amount===0) break;
          let payAmount = Math.min(payer.amount, receiver.amount);
          settlementList.innerHTML += `<li>${payer.name} pays ${receiver.name} BDT ${payAmount.toFixed(2)}</li>`;
          payer.amount-=payAmount; receiver.amount-=payAmount;
        }
      }
    }

    function toggleDarkMode(){
      document.body.classList.toggle("dark");
    }

    async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  
  // Title
  doc.setFontSize(18);
  doc.setTextColor(79,70,229); // primary color
  doc.text("Tour Expense Report", 105, 15, { align: "center" });

  let y = 25;
  doc.setFontSize(14);
  doc.setTextColor(0,0,0);
  
  // Expense Statement
  doc.text("Expense Statement", 14, y);
  y += 6;

  const expenseRows = expenses.map(e => [
    e.date || "No Date",
    e.payer,
    e.type,
    `BDT ${e.amount.toFixed(2)}`
  ]);

  doc.autoTable({
    startY: y,
    head: [['Date','Payer','Expense Type','Amount']],
    body: expenseRows,
    styles: { fontSize: 10, cellPadding: 3 },
    headStyles: { fillColor: [79,70,229], textColor: 255, fontStyle: 'bold' },
    alternateRowStyles: { fillColor: [230, 235, 255] },
  });

  y = doc.lastAutoTable.finalY + 10;

  // Member Balances
  doc.text("Member Balances", 14, y);
  y += 6;

  const balances = {};
  members.forEach(m => balances[m] = 0);
  expenses.forEach(e => balances[e.payer] += e.amount);
  const totalExpense = expenses.reduce((a,b)=>a+b.amount,0);
  const equalShare = totalExpense / members.length;
  members.forEach(m => balances[m] -= equalShare);

  const balanceRows = members.map(m => [
    m,
    `BDT ${(balances[m]+equalShare).toFixed(2)}`,
    `BDT ${equalShare.toFixed(2)}`,
    { content: `BDT ${balances[m].toFixed(2)}`, styles: { textColor: balances[m]>=0?[16,185,129]:[239,68,68], fontStyle:'bold' } }
  ]);

  doc.autoTable({
    startY: y,
    head: [['Name','Paid','Should Pay','Balance']],
    body: balanceRows,
    styles: { fontSize: 10, cellPadding: 3 },
    headStyles: { fillColor: [79,70,229], textColor: 255, fontStyle: 'bold' },
    alternateRowStyles: { fillColor: [230, 235, 255] },
  });

  y = doc.lastAutoTable.finalY + 10;

  // Settlement Suggestions
  doc.text("Settlement Suggestions", 14, y);
  y += 6;

  let payers = [], receivers = [];
  for(let [name,b] of Object.entries(balances)){
    if(b<0) payers.push({name, amount:-b});
    else if(b>0) receivers.push({name, amount:b});
  }
  payers.sort((a,b)=>b.amount-a.amount);
  receivers.sort((a,b)=>b.amount-a.amount);

  const settlementRows = [];
  for(let p of payers){
    for(let r of receivers){
      if(p.amount===0) break;
      let amt = Math.min(p.amount, r.amount);
      settlementRows.push([`${p.name} pays ${r.name}`, `BDT ${amt.toFixed(2)}`]);
      p.amount-=amt; r.amount-=amt;
    }
  }

  doc.autoTable({
    startY: y,
    head: [['Instruction','Amount']],
    body: settlementRows,
    styles: { fontSize: 10, cellPadding: 3 },
    headStyles: { fillColor: [79,70,229], textColor: 255, fontStyle: 'bold' },
    alternateRowStyles: { fillColor: [230, 235, 255] },
  });

  // Footer
  doc.setFontSize(10);
  doc.setTextColor(120,120,120);
  doc.text("Generated by Tour Expense Tracker Â© 2025", 105, 290, { align: "center" });

  doc.save('Tour_Expense_Report.pdf');
}
  </script>
</body>
</html>
